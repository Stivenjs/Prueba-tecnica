<mat-card>
  <mat-card-header>
    <mat-card-title>
      {{ isEditMode ? 'Editar Asegurado' : 'Nuevo Asegurado' }}
    </mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <form [formGroup]="insuredForm" (ngSubmit)="onSubmit()" class="form-container">
      
      <!-- Número de Identificación -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Número de Identificación *</mat-label>
        <input 
          matInput 
          type="number" 
          formControlName="identificationNumber"
          placeholder="Ej: 1234567890">
        <mat-error *ngIf="insuredForm.get('identificationNumber')?.invalid">
          {{ getErrorMessage('identificationNumber') }}
        </mat-error>
      </mat-form-field>

      <!-- Nombres -->
      <div class="row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Primer Nombre *</mat-label>
          <input 
            matInput 
            formControlName="firstName"
            placeholder="Ej: Juan">
          <mat-error *ngIf="insuredForm.get('firstName')?.invalid">
            {{ getErrorMessage('firstName') }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Segundo Nombre</mat-label>
          <input 
            matInput 
            formControlName="middleName"
            placeholder="Ej: Carlos">
          <mat-error *ngIf="insuredForm.get('middleName')?.invalid">
            {{ getErrorMessage('middleName') }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Apellidos -->
      <div class="row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Primer Apellido *</mat-label>
          <input 
            matInput 
            formControlName="firstLastName"
            placeholder="Ej: Pérez">
          <mat-error *ngIf="insuredForm.get('firstLastName')?.invalid">
            {{ getErrorMessage('firstLastName') }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Segundo Apellido *</mat-label>
          <input 
            matInput 
            formControlName="secondLastName"
            placeholder="Ej: García">
          <mat-error *ngIf="insuredForm.get('secondLastName')?.invalid">
            {{ getErrorMessage('secondLastName') }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Contacto -->
      <div class="row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Teléfono de Contacto *</mat-label>
          <input 
            matInput 
            formControlName="contactPhone"
            placeholder="Ej: 3001234567">
          <mat-error *ngIf="insuredForm.get('contactPhone')?.invalid">
            {{ getErrorMessage('contactPhone') }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Correo Electrónico *</mat-label>
          <input 
            matInput 
            type="email" 
            formControlName="email"
            placeholder="Ej: juan.perez@example.com">
          <mat-error *ngIf="insuredForm.get('email')?.invalid">
            {{ getErrorMessage('email') }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Fecha y Valor -->
      <div class="row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Fecha de Nacimiento *</mat-label>
          <input 
            matInput 
            [matDatepicker]="picker"
            formControlName="birthDate"
            [max]="maxDate"
            placeholder="DD/MM/AAAA">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-error *ngIf="insuredForm.get('birthDate')?.invalid">
            {{ getErrorMessage('birthDate') }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Valor Estimado de Solicitud *</mat-label>
          <input 
            matInput 
            type="number" 
            formControlName="estimatedRequestValue"
            placeholder="Ej: 5000000">
          <span matPrefix>$ &nbsp;</span>
          <mat-error *ngIf="insuredForm.get('estimatedRequestValue')?.invalid">
            {{ getErrorMessage('estimatedRequestValue') }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Observaciones -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Observaciones</mat-label>
        <textarea 
          matInput 
          formControlName="observations"
          rows="4"
          placeholder="Ingrese observaciones adicionales..."></textarea>
        <mat-hint align="end">
          {{ insuredForm.get('observations')?.value?.length || 0 }} / 500
        </mat-hint>
        <mat-error *ngIf="insuredForm.get('observations')?.invalid">
          {{ getErrorMessage('observations') }}
        </mat-error>
      </mat-form-field>

      <!-- Botones -->
      <div class="form-actions">
        <button 
          mat-raised-button 
          type="button" 
          (click)="onCancel()"
          [disabled]="isLoading">
          Cancelar
        </button>
        
        <button 
          mat-raised-button 
          color="primary" 
          type="submit"
          [disabled]="isLoading || insuredForm.invalid">
          <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
          <span *ngIf="!isLoading">
            {{ isEditMode ? 'Actualizar' : 'Guardar' }}
          </span>
        </button>
      </div>

    </form>
  </mat-card-content>
</mat-card>
